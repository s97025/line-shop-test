<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>LIFF æ¸¬è©¦</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2 id="status">è¼‰å…¥ä¸­...</h2>
  <p id="name"></p>

  <script>
    const LIFF_ID = "2008849957-uFo5FsLU";

    liff.init({ liffId: LIFF_ID })
      .then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          liff.getProfile().then(profile => {
            document.getElementById("status").innerText = "ç™»å…¥æˆåŠŸ";
            document.getElementById("name").innerText =
              "ä½ å¥½ï¼Œ" + profile.displayName;
          });
        }
      })
      .catch(err => {
        document.getElementById("status").innerText = "éŒ¯èª¤ï¼š" + err;
      });
  </script>

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase SDKï¼ˆv10ï¼Œé©åˆ GitHub Pages + LIFFï¼‰
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      updateDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  
    // ğŸ”‘ Firebase è¨­å®šï¼ˆç”¨ä½ å‰›å‰›è¤‡è£½çš„ï¼‰
    const firebaseConfig = {
      apiKey: "AIzaSyAk5SaAAvifvTV3dUW4mddRvvgySbdIysc",
      authDomain: "line-shop-ef578.firebaseapp.com",
      projectId: "line-shop-ef578",
      storageBucket: "line-shop-ef578.firebasestorage.app",
      messagingSenderId: "909569598609",
      appId: "1:909569598609:web:e97cd2760f1df886114b30"
    };
  
    // åˆå§‹åŒ– Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
  
    console.log("ğŸ”¥ Firebase connected", db);
  
    // ===== æ¸¬è©¦ï¼šå¯«å…¥ä¸€ç­†è¨‚å–®ï¼ˆç­‰ç­‰æœƒæ›æˆçœŸçš„åœ˜è³¼é‚è¼¯ï¼‰ =====
    async function testWriteOrder() {
      const testOrderRef = doc(db, "orders", "test-order-001");
      await setDoc(testOrderRef, {
        userId: "TEST_USER",
        displayName: "æ¸¬è©¦ä½¿ç”¨è€…",
        totalAmount: 123,
        createdAt: serverTimestamp()
      });
      console.log("âœ… Test order written");
    }
  
    // å…ˆè·‘ä¸€æ¬¡æ¸¬è©¦
    testWriteOrder();
  </script>

</body>
</html>

<!-- force redeploy -->
